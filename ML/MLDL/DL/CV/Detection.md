Обнаружение объектов на изображении.
В задачи обнаружения входят следующие шаги:
1. Находятся координаты ограничивающих рамок (bounding boxes), которые выделяют найденный на изображении объект
2. Объект в рамке классифицируется.
Формально задача сводится к поиску:
$$
(b_x, b_y, b_h, b_w, p_1, ..., p_k)
$$
Где, $b_x, b_y, b_w, b_h$ - координаты ограничивающей рамки (может задаваться по-разному) и $p_1, ..., p_k$ распределение вероятностей классов.
## Архитектуры

[[YOLO]]
[[CRAFT]]
[[FAST]]

## Метрики качества

Для классификации используются стандартные метрики, см. [[Классификация]]
### Локализация

**Intersection over Union (IoU)** - это метрика, используемая для оценки качества сегментации, детекции и т.п. Она измеряет степень пересечения между предсказанной и истинной областью. 
$$
IoU = \frac{Intersection}{Union} = \frac{Area \space of \space overlap}{Area \space of \space combined \space regions}
$$
Чем выше, тем лучше. $IoU=0$ боксы не пересекаются, $IoU=1$ - идеальное совпадение. 
Пример: 
Пусть боксы заданы в формате - $(x_1, y_1, x_2, y_2)$, где $x_1, y_1$ - координаты левого верхнего угла бокса, а $x_2, y_2$ правого нижнего. Тогда, 
$$
\begin{align}
(x_1, y_1, x_2, y_2) - True \space box  \\
(\bar{x}_1, \bar{y}_1, \bar{x}_2, \bar{y}_2) - pred \space box
\end{align}
$$
Вычисляем координаты бокса пересечения - 
$$
\begin{align}
x^{\text{inter}}_1 &= \max(x_1, \bar{x}_1) \\
y^{\text{inter}}_1 &= \max(y_1, \bar{y}_1) \\
x^{\text{inter}}_2 &= \min(x_2, \bar{x}_2) \\
y^{\text{inter}}_2 &= \min(y_2, \bar{y}_2)
\end{align}
$$
Если $x^{\text{inter}}_2 > x^{\text{inter}}_1$ и $y^{\text{inter}}_2 > y^{\text{inter}}_1$ значит пересечение существует, иначе $IoU = 0$. 
Теперь просто считаем площадь прямоугольника пересечения и делим его на общую площадь 
$$
\frac{area_{overlap}}{area_{true} + area_{pred} - area_{overlap}}
$$
Эта метрика показывает долю площади пересечения от всей площади.

Для оценки качества нахождения объекта используется **mean Average Precision (mAP)**

Для каждого бокса считаем **IoU**. Задаем порог **Threshold** при котором будем считать предсказания успешными, например для **mAP50** это $IoU>0.5$.
Считаем количество **TP** и **FP**:
- **TP** если $IoU>Threshold$
- **FP** иначе
Считаем **Precision**, **Recall**, строим **PR** и считаем **AP**. Усредняем все **AP** по классам.
$$
Recall = \frac{TP}{All\space GT}
$$
$$
Precision = \frac{TP}{TP + FP}
$$
$$
mAP = \frac{1}{K}\sum_{i=1}^{K}{AP_i}
$$
**mAP50-95** - это средний **mAP** по всем **Threshold** от 0.5 до .95 с шагом 0.05.

