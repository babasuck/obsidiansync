MongoDB - не реляционная база данных. (no-sql)

На этой странице описана основная информация о MongoDB, как настроить для начала работы, создать пользователей, назначить роли.

[[Манипуляция данными MongoDB]]
## Устройство базы данных

Состоит из коллекций (аналог таблиц в SQL), таблицы состоят из документов. 
Документ представляет собой json-like структуру хранения данных.
Интерпретатор команд `mangosh` основан на JavaScript, принимает корректные с точки зрения JS выражения.

```json
{
    "name": "Tom",
    "surname":"Smith",
    "age": "37",
    "company": {
        "name" : "Microsoft",
        "salary" : "100"
    }
}
```

Данные хранятся в формате *BSON*, похожий на *JSON*. 

## Создание и администрирование базой данных

### Создание и открытие БД

`monosh` - утилита для взаимодействия с `mongod` 

**Параметры запуска**

| Параметр   | Назначение                                                         |
| ---------- | ------------------------------------------------------------------ |
| `--dbpath` | указывает путь, где будут хранится данные, по умолчанию `/data/db` |
|            |                                                                    |


Открыть базу данных `use name` (если такой БД нет, то она создастся автоматически). 

Список всех созданных БД `show dbs`

### Информация о БД
Список коллекций `show collections` (таблиц)

**Методы объекта db**

| Метод                         | Описание                |
| ----------------------------- | ----------------------- |
| `stats()`                     | статистика БД           |
| `createCollection(name, opt)` | создать новую коллекцию |
|                               |                         |
|                               |                         |


### Обращение к коллекции

Коллекция создается автоматически неявно при первом добавлении данных в нее, например `db.col.insertOne()`, явно создать можно через `db.createCollection(name, options)`
Можно создавать вложенные коллекции `db.col.col1`, при этом они не будут никак связаны, это чисто логическая организация.

**Методы коллекций**

| Метод                | Описание                                             |
| -------------------- | ---------------------------------------------------- |
| `stats()`            | выводит статситику коллекции                         |
| `renameCollection()` | переименовать коллекцию                              |
| `insertOne()`        | вставить документ в коллекцию                        |
| `insertMany()`       | вставить несколько документов                        |
| `find()`             | найти документ, без параметров выводит все документы |
| `findOne()`          | найти один документ                                  |
|                      |                                                      |
|                      |                                                      |

### Безопасность 

MongoDB представляет множество способов безопасного доступа, например [[SCRAM]]

**Создание пользователей**

В начале работы с базой данных нужно создать администратора.
```shell
db.createUser(
	{
		user: "dbadmin",
		pwd: passwordPrompt(),
		roles: [
			{role: "userAdminAnyDatabase", db: "admin" },
			{role: "readWriteAnyDatabase", db: "admin" }
		]
	}
)
```

**Основные методы (под админом)**

| Метод                     | Описание                   |
| ------------------------- | -------------------------- |
| `db.getUsers()`           | список пользователей       |
| `db.updateUser()`         | обновить роли пользователя |
| `db.changeUserPassword()` | сменить пароль             |
|                           |                            |

**Авторизация 
производится в базе данных `admin`, которая является базой данных аутентификации пользователей. 
 
```shell
use admin
db.auth("user", passwordPrompt())
```

**Роли**

К каждой роли можно добавить `AnyDatabase` и выбрать базу `admin` и тогда она распространится на все базы, иначе надо указывать базу в ключе `db`

| Роль            | Описание            |
| --------------- | ------------------- |
| `readWrite`     | читать и записывать |
| `read`\ `write` | что-то одно         |
|                 |                     |
|                 |                     |

